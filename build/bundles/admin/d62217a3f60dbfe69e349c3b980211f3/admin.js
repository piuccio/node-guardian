"format register";!function(){function t(){}t.amd={},System.register("admin/modules/abtests/participation-item",["common/utils/_","common/modules/component"],!1,function(t,e,n){return function(t,e){function n(e){this.config=t.extend(this.config,e)}return e.define(n),n.prototype.config={test:"",variant:""},n.prototype.templateName="participation-item-template",n.prototype.componentClass="participation-item",n.prototype.classes={},n.prototype.useBem=!0,n.prototype.prerender=function(){var t=/gutools.co.uk$/.test(document.location.origin)?"http://www.theguardian.com":document.location.origin;this.elem.textContent=this.config.variant,this.elem.href=t+"/uk#ab-"+this.config.test+"="+this.config.variant},n}.call(this,t("common/utils/_"),t("common/modules/component"))})}(),function(){function t(){}t.amd={},System.register("admin/modules/abtests/abtest-report-item",["common/utils/_","common/modules/component","admin/modules/abtests/participation","npm:bonzo@1.4.0","npm:qwery@3.4.2","npm:bean@1.0.15"],!1,function(t,e,n){return function(t,e,n,o,i,s){function r(e){this.config=t.extend(t.clone(this.config),e),window.abCharts&&(this.chart=window.abCharts["ab"+this.config.test.id])}return e.define(r),r.prototype.config={test:{},active:!0},r.prototype.templateName="abtest-item-template",r.prototype.componentClass="abtest-item",r.prototype.useBem=!0,r.prototype.renderChart=function(){this.chart&&new google.visualization.LineChart(this.getElem("chart")).draw(google.visualization.arrayToDataTable(this.chart.data),{colors:this.chart.colors,curveType:"function",chartArea:{width:"100%",height:160,top:0,left:15},legend:{position:"in"},vAxis:{title:"Pageviews/session",textPosition:"in",titleTextStyle:{fontSize:11}},fontName:"Helvetica"})},r.prototype.prerender=function(){this.elem.className+=this.config.active?" abtest-item--active":" abtest-item--expired",this.elem.setAttribute("data-abtest-name",this.config.test.id),o(this.elem).addClass(window.abSwitches["ab"+this.config.test.id]?"abtest-item--switched-on":"abtest-item--switched-off"),this.getElem("name").textContent=this.config.test.id;var t=(Date.parse(this.config.test.expiry)-new Date)/864e5;this.getElem("expiry").textContent=Math.floor(t).toString()+(1==t?" day":" days"),this.getElem("expiry").setAttribute("title",this.config.test.expiry),this.getElem("audience").textContent=100*this.config.test.audience+"%",this.getElem("audience-offset").textContent=100*this.config.test.audienceOffset+"%";var e="https://tableau-datascience.gutools.co.uk/#/views/AutomatedMVTDashboard/MainMVTDashboard?id="+this.config.test.id;this.getElem("tableau").innerHTML="<a href='"+e+"'>view</a>";var i="https://dashboard.ophan.co.uk/graph/breakdown?ab="+this.config.test.id;this.getElem("ophan").innerHTML="<a href='"+i+"'>graph</a>";var s=new n({test:this.config.test});s.render(this.getElem("participation"))},r.prototype.ready=function(){if(this.chart){var t=this.renderChart.bind(this);t();var e;s.on(window,"resize",function(){e&&window.clearTimeout(e),e=window.setTimeout(t,150)})}},r}.call(this,t("common/utils/_"),t("common/modules/component"),t("admin/modules/abtests/participation"),t("npm:bonzo@1.4.0"),t("npm:qwery@3.4.2"),t("npm:bean@1.0.15"))})}(),function(){function t(){}t.amd={},System.register("admin/modules/abtests/audience-item",["common/utils/_","common/modules/component","npm:bonzo@1.4.0"],!1,function(t,e,n){return function(t,e,n){function o(e){this.config=t.extend(t.clone(this.config),e)}return e.define(o),o.prototype.config={test:{}},o.prototype.templateName="audience-item-template",o.prototype.componentClass="audience-item",o.prototype.useBem=!0,o.prototype.prerender=function(){n(this.getElem("test-label")).prepend(this.config.test.id);var t=100*this.config.test.audience,e=100*this.config.test.audienceOffset,o=t+e;this.getElem("test").style.width=t.toString()+"%",this.getElem("test").style.left=e.toString()+"%",n(this.getElem("caption-test")).append(this.config.test.id),n(this.getElem("caption-range")).append(e+"% to "+o+"%")},o.prototype.ready=function(){},o}.call(this,t("common/utils/_"),t("common/modules/component"),t("npm:bonzo@1.4.0"))})}(),function(){function t(){}t.amd={},System.register("admin/bootstraps/adunitapproval",["common/utils/$","npm:bean@1.0.15"],!1,function(t,e,n){return function(t,e){function n(){t(".select-all-adunits").each(function(n){e.on(n,"click",function(){t(".status").each(function(t){t.checked=!0})})}),t(".deselect-all-adunits").each(function(n){e.on(n,"click",function(){t(".status").each(function(t){t.checked=!1})})})}return{init:n}}.call(this,t("common/utils/$"),t("npm:bean@1.0.15"))})}(),function(){function t(){}t.amd={},System.register("admin/bootstraps/browserstats",["common/utils/$","npm:bonzo@1.4.0","common/utils/_","npm:bean@1.0.15"],!1,function(t,e,n){return function(t,e,n,o){function i(){t(".browser-table").each(function(){var i=t(this),r=this.querySelectorAll("tbody tr"),a=i.data("total");e(this.querySelectorAll(".format-number")).each(function(){var t=this.getAttribute("data-value"),e=(t/a*100).toFixed(2),n=s(t)+' <span class="perc">'+e+"%</span>";this.innerHTML=n}),o.on(this.querySelector(".search-query"),"keyup",n.debounce(function(){var t=new RegExp(this.value,"i"),n=0;e(r).each(function(){var e=this.children[1].innerHTML.toLowerCase();t.test(e)?(this.style.display="table-row",n+=parseInt(this.children[2].getAttribute("data-value"),10)):this.style.display="none"});var o=s(n)+' <span class="perc">'+(n/a*100).toFixed(2)+"%</span>";e(this.querySelector(".total")).html(o)},250))})}function s(t){t=t.toString();for(var e=/(-?\d+)(\d{3})/;e.test(t);)t=t.replace(e,"$1,$2");return t}return{init:i}}.call(this,t("common/utils/$"),t("npm:bonzo@1.4.0"),t("common/utils/_"),t("npm:bean@1.0.15"))})}(),function(){function t(){}t.amd={},System.register("admin/bootstraps/radiator",["common/utils/ajax","common/utils/$","common/utils/_"],!1,function(t,e,n){return function(t,e,n){function o(){var o=document.getElementById("pingdom");t({url:"/radiator/pingdom",type:"json",crossOrigin:!1}).then(function(t){t.checks.filter(function(t){return/elb|host|cdn|rss/.test(t.name.toLowerCase())}).forEach(function(t){var e=document.createElement("li");e.className=t.status,e.textContent=t.name,e.setAttribute("title",t.name),o.appendChild(e)})}),t({url:"https://riffraff.gutools.co.uk/api/history?projectName=frontend%3A%3A&key=oFsACDUt5L2HfLgfdSW2Xf1nbOKHLN5A&pageSize=200",type:"jsonp",crossOrigin:!0}).then(function(e){function n(e,n,o){var i=e+"-"+n;if(!document.getElementById(i)){var s=document.getElementById("deployers"+e),r=document.createElement("li");r.setAttribute("id",i),s.appendChild(r),t({url:"/radiator/commit/"+n,type:"json"}).then(function(t){t.commit&&(r.innerHTML=t.commit.author.name+" <small>(deployed by "+o+")</small>")})}}function o(t,e){Object.keys(i[t]).forEach(function(o){var s=i[t][o],r=s.projectName.substr(10,4),a=document.createElement("a");a.href="https://riffraff.gutools.co.uk/deployment/view/"+s.uuid,e.appendChild(a);var c=document.createElement("li");if(c.className=s.status,c.innerHTML=r+" "+s.build,c.setAttribute("title",s.projectName),a.appendChild(c),i.CODE[o]&&"PROD"===t&&"Completed"===s.status){var l=(i.CODE[o]||{}).build;l!==s.build&&(c.className="Behind")}"Completed"!==s.status&&n(t,s.tags.vcsRevision,s.deployer)})}var i={CODE:{},PROD:{}};e.response.results.filter(function(t){return/^frontend::/.test(t.projectName)}).forEach(function(t){var e=t.projectName,n=t.stage;n&&i[n]&&!i[n].hasOwnProperty(e)&&(i[n][e]=t)}),o("CODE",riffraffCODE),o("PROD",riffraffPROD)}),t({url:"/ophan/pageviews",type:"json"}).then(function(t){var o=n.groupBy(n.flatten(n.pluck(t.seriesData,"data")),function(t){return t.dateTime}),i=Object.keys(o);delete o[n.first(i)],delete o[n.last(i)];var s=[["time","pageviews"]];n.forEach(o,function(t,e){var o=parseInt(e,10),i=new Date(o),r=("0"+i.getHours()).slice(-2),a=("0"+i.getMinutes()).slice(-2),c=r+":"+a,l=n.reduce(t,function(t,e){return e.count+t},0);s.push([c,l])}),new google.visualization.LineChart(document.getElementById("pageviews")).draw(google.visualization.arrayToDataTable(s),{title:"Page views",backgroundColor:"#fff",colors:["#e6711b"],height:160,legend:"none",fontName:"Georgia",titleTextStyle:{color:"#999"},hAxis:{textStyle:{color:"#ccc"},gridlines:{count:0},showTextEvery:15,baselineColor:"#fff"},smoothLine:!0,chartArea:{width:"85%"}});var r=n.reduce(n.last(n.values(o)),function(t,e){return e.count+t},0),a=Math.round(r/60);e(".pageviews-per-second").html("("+a+" views/sec)")}),e(".buildConfigurationName").each(function(t){var n=e("img",t),o=n.attr("src").indexOf("success.png")>=0,i=e("a",t),s=i[0].innerText,r=o?"success":"failure";n.replaceWith('<div title="'+s+'" class="'+r+'">'+s+"</div>"),i.remove()})}return{init:o}}.call(this,t("common/utils/ajax"),t("common/utils/$"),t("common/utils/_"))})}(),function(){function t(){}t.amd={},System.register("admin/bootstraps/commercial",["npm:qwery@3.4.2","npm:bean@1.0.15","npm:bonzo@1.4.0","common/utils/_","common/utils/$","common/utils/ajax","common/utils/url"],!1,function(t,e,n){return function(t,e,n,o,i,s,r){function a(){var t=/[?&]hours=([^&]*)/.exec(window.location.search);return t?t[1]:24}function c(){function c(e){u.removeClass("ajax-failed").addClass("ajax-loading"),s({url:"/ophan/ads/render-time?"+r.constructQuery({"ad-slot":"dfp-ad--"+e,platform:"next-gen",hours:a()}),type:"json"}).then(function(e){var n=[["Time","Next-Gen"]].concat(e.buckets.map(function(t){return[new Date(t.time),Math.max(t.avgTimeToRenderEnded/1e3,0)]}));new google.visualization.LineChart(t("#render-time--ad__graph")[0]).draw(google.visualization.arrayToDataTable(n),{fontName:"Georgia",legend:"none",title:"Average render time for a particular ad slot on Next Gen (secs)",titleTextStyle:{fontName:"Georgia",color:"#222",italic:!0,bold:!1},hAxis:{format:"HH:mm"},trendlines:{0:{color:"green"}}})}).always(function(){u.removeClass("ajax-loading")}).fail(function(){u.addClass("ajax-failed")})}var l=i(".render-time--ads"),u=i(".render-time--ad");l.removeClass("ajax-failed").addClass("ajax-loading"),s({url:"/ophan/ads/render-time?"+r.constructQuery({platform:"next-gen",hours:a()}),type:"json"}).then(function(e){s({url:"/ophan/ads/render-time?"+r.constructQuery({platform:"r2",hours:a()}),type:"json"}).then(function(n){var i=n.buckets,s=[["Time","Next Gen","R2"]].concat(e.buckets.map(function(t){var e=o.where(i,{time:t.time});return[new Date(t.time),Math.max(t.avgTimeToRenderEnded/1e3,0),e.length?Math.max(e.shift().avgTimeToRenderEnded/1e3,0):0]}));new google.visualization.LineChart(t("#render-time--ads__graph")[0]).draw(google.visualization.arrayToDataTable(s),{fontName:"Georgia",title:"Average render time across all ad slots (secs)",titleTextStyle:{fontName:"Georgia",color:"#222",italic:!0,bold:!1},hAxis:{format:"HH:mm"}})}).always(function(){l.removeClass("ajax-loading")}).fail(function(){l.addClass("ajax-failed")})}).fail(function(){l.removeClass("ajax-loading").addClass("ajax-failed")}),t(".ad-render-filter__time .dropdown-menu a").forEach(function(t){var e=n(t);e.attr("href")==="?hours="+a()&&e.parent().addClass("active")});var d=/[?&]ad-slot=([^&]+)/.exec(document.location.search),m=i.create("<select></select>").addClass("form-control render-time--ad__form__select"),p=i.create("<label></label>").addClass("render-time--ad__form__label").text("Ad slot:").append(m);["top-above-nav","top","inline1","inline2","right","merchandising-high","merchandising"].forEach(function(t,e){i.create("<option></option>").val(t).text(t).attr("selected",d?d[1]===t:0===e).appendTo(m)}),i.create("<form></form>").addClass("render-time--ad__form").append(p).prependTo(t(".render-time--ad")[0]),e.on(m[0],"change",function(t){var e=t.target.value;window.history.pushState({},"","?ad-slot="+e+"&hours="+a()),i("#render-time--ad__graph").html(""),c(e)}),c(m.val())}return{init:c}}.call(this,t("npm:qwery@3.4.2"),t("npm:bean@1.0.15"),t("npm:bonzo@1.4.0"),t("common/utils/_"),t("common/utils/$"),t("common/utils/ajax"),t("common/utils/url"))})}(),function(){function t(){}t.amd={},System.register("admin/bootstraps/commercial/adTests",["npm:bean@1.0.15","common/utils/$","common/utils/cookies"],!1,function(t,e,n){return function(t,e,n){function o(){var t=n.get(a);e(".cookie-row").removeClass("selected"),null==t?(e("#cookie-status").text("Your browser has no test cookie set.").addClass("hasnt-cookie"),e("#clear-cookie").hide()):(e("#cookie-status").text("Your browser has test cookie '"+t+"' set.").addClass("has-cookie"),e("#cookie-"+t).addClass("selected"))}function i(t){var e="http://www.theguardian.com/uk?"+r+"="+t,n=window.open(e,"_blank","width=100,height=100");setTimeout(function(){n.close()},1e3)}function s(){o(),t.on(document,"click",".cookie",function(t){var s=t.srcElement.value;i(s),n.add(a,s,10),e("#clear-cookie").show(),o()}),t.on(document,"click","#clear-cookie",function(){i("clear"),n.remove(a),e("#clear-cookie").hide(),o()})}var r="adtest",a="adtest-tracker";return{init:s}}.call(this,t("npm:bean@1.0.15"),t("common/utils/$"),t("common/utils/cookies"))})}(),System.register("npm:domready@1.0.8/ready",[],!0,function(require,t,e){var n=System.global,o=n.define;return n.define=void 0,!function(t,n){"undefined"!=typeof e?e.exports=n():"function"==typeof define&&"object"==typeof define.amd?define(n):this[t]=n()}("domready",function(){var t,e=[],n=document,o=n.documentElement.doScroll,i="DOMContentLoaded",s=(o?/^loaded|^c/:/^loaded|^i|^c/).test(n.readyState);return s||n.addEventListener(i,t=function(){for(n.removeEventListener(i,t),s=1;t=e.shift();)t()}),function(t){s?setTimeout(t,0):e.push(t)}}),n.define=o,e.exports}),function(){function t(){}t.amd={},System.register("admin/modules/abtests/participation",["common/utils/_","common/modules/component","admin/modules/abtests/participation-item"],!1,function(t,e,n){return function(t,e,n){function o(e){this.config=t.extend(this.config,e)}return e.define(o),o.prototype.config={test:""},o.prototype.templateName="participation-template",o.prototype.componentClass="participation",o.prototype.useBem=!0,o.prototype.prerender=function(){var t=this.config.test,e=/gutools.co.uk$/.test(document.location.origin)?"http://www.theguardian.com":document.location.origin;this.getElem("opt-out").href=e+"/uk#ab-"+t.id+"=notintest";var o=this.getElem("links");t.variants.forEach(function(e){new n({test:t.id,variant:e.id}).render(o)})},o}.call(this,t("common/utils/_"),t("common/modules/component"),t("admin/modules/abtests/participation-item"))})}(),function(){function t(){}t.amd={},System.register("admin/modules/abtests/audience",["common/utils/_","common/modules/component","admin/modules/abtests/audience-item"],!1,function(t,e,n){return function(t,e,n){function o(e){this.config=t.extend(t.clone(this.config),e)}return e.define(o),o.prototype.config={tests:[]},o.prototype.templateName="audience-template",o.prototype.componentClass="audience-breakdown",o.prototype.useBem=!0,o.prototype.prerender=function(){var t=this.getElem("tests");this.config.tests.forEach(function(e){new n({test:e}).render(t)})},o.prototype.ready=function(){},o}.call(this,t("common/utils/_"),t("common/modules/component"),t("admin/modules/abtests/audience-item"))})}(),System.register("npm:domready@1.0.8",["npm:domready@1.0.8/ready"],!0,function(require,t,e){var n=System.global,o=n.define;return n.define=void 0,e.exports=require("npm:domready@1.0.8/ready"),n.define=o,e.exports}),function(){function t(){}t.amd={},System.register("admin/modules/abtests/abtest-report",["common/utils/_","common/modules/component","admin/modules/abtests/participation","npm:bonzo@1.4.0","npm:qwery@3.4.2","npm:bean@1.0.15"],!1,function(t,e,n){return function(t,e,n,o,i,s){function r(e){this.config=t.extend(t.clone(this.config),e),window.abCharts&&(this.chart=window.abCharts["ab"+this.config.test.id])}return e.define(r),r.prototype.config={test:{},active:!0},r.prototype.templateName="abtest-report-template",r.prototype.componentClass="abtest-report",r.prototype.useBem=!0,r.prototype.renderChart=function(){this.chart&&new google.visualization.LineChart(this.getElem("chart")).draw(google.visualization.arrayToDataTable(this.chart.data),{colors:this.chart.colors,curveType:"function",chartArea:{width:"100%",height:160,top:0,left:15},legend:{position:"in"},vAxis:{title:"Pageviews/session",textPosition:"in",titleTextStyle:{fontSize:11}},fontName:"Helvetica"})},r.prototype.prerender=function(){this.elem.className+=this.config.active?" abtest-item--active":" abtest-item--expired",this.elem.setAttribute("data-abtest-name",this.config.test.id),o(this.elem).addClass(window.abSwitches["ab"+this.config.test.id]?"abtest-item--switched-on":"abtest-item--switched-off")},r.prototype.ready=function(){if(this.chart){var t=this.renderChart.bind(this);t();var e;s.on(window,"resize",function(){e&&window.clearTimeout(e),e=window.setTimeout(t,150)})}},r}.call(this,t("common/utils/_"),t("common/modules/component"),t("admin/modules/abtests/participation"),t("npm:bonzo@1.4.0"),t("npm:qwery@3.4.2"),t("npm:bean@1.0.15"))})}(),function(){function t(){}t.amd={},System.register("admin/bootstraps/abtests",["common/modules/experiments/ab","npm:qwery@3.4.2","npm:bean@1.0.15","admin/modules/abtests/abtest-report","admin/modules/abtests/abtest-report-item","admin/modules/abtests/audience"],!1,function(t,e,n){return function(t,e,n,o,i,s){function r(t,e,n){var o=t.map(function(t){return new i({test:t,active:e})});return o.forEach(function(t){t.render(n)}),o}function a(){r(t.getActiveTests(),!0,e(".abtests-report__data"));var o=r(t.getExpiredTests(),!1,e(".abtests-expired")),i=new s({tests:t.getActiveTests()});i.render(e(".abtests-audience"));var a=e(".abtests-expired")[0];n.on(e(".abtests-expired-title a")[0],"click",function(t){t.preventDefault(),"show"==t.currentTarget.textContent?(t.currentTarget.textContent="hide",a.style.display="block",o.forEach(function(t){t.renderChart()})):(t.currentTarget.textContent="show",a.style.display="none")}),setTimeout(function(){a.style.display="none"},0)}return{init:a}}.call(this,t("common/modules/experiments/ab"),t("npm:qwery@3.4.2"),t("npm:bean@1.0.15"),t("admin/modules/abtests/abtest-report"),t("admin/modules/abtests/abtest-report-item"),t("admin/modules/abtests/audience"))})}(),function(){function t(){}t.amd={},System.register("bootstraps/admin",["common/utils/ajax","admin/bootstraps/abtests","admin/bootstraps/adunitapproval","admin/bootstraps/browserstats","admin/bootstraps/radiator","admin/bootstraps/commercial","admin/bootstraps/commercial/adTests","npm:domready@1.0.8"],!1,function(t,e,n){return function(t,e,n,o,i,s,r,a){a(function(){switch(t.setHost(""),window.location.pathname){case"/analytics/abtests":e.init();break;case"/analytics/browsers":o.init();break;case"/analytics/commercial":s.init();break;case"/radiator":i.init();break;case"/commercialtools/adunits/toapprove":n.init();break;case"/analytics/commercial/adtests":r.init()}})}.call(this,t("common/utils/ajax"),t("admin/bootstraps/abtests"),t("admin/bootstraps/adunitapproval"),t("admin/bootstraps/browserstats"),t("admin/bootstraps/radiator"),t("admin/bootstraps/commercial"),t("admin/bootstraps/commercial/adTests"),t("npm:domready@1.0.8"))})}();