"format register";!function(){function t(){}t.amd={},System.register("common/utils/fsm",[],!1,function(t,e,i){return function(){function t(t){this.context=t.context||void 0,this.states=t.states||{},this.context.state=t.initial||"",this.debug=t.debug||!1,this.onChangeState=t.onChangeState.bind(this.context)||function(){}}return t.prototype.log=function(){this.debug&&window.console&&window.console.log.apply(window.console,arguments)},t.prototype.trigger=function(t,e){this.log("fsm: (event)",t);var i=this.context.state,n=function(){};(this.states[i].events[t]||n).call(this.context,e),(i!==this.context.state||this.context.reloadState)&&(this.context.reloadState=!1,this.onChangeState(i,this.context.state),(this.states[i].leave||n).apply(this.context),(this.states[this.context.state].enter||n).apply(this.context),this.log("fsm: (state)",i+" -> "+this.context.state))},t}.call(this)})}(),function(){function t(){}t.amd={},System.register("common/modules/ui/blockSharing",["npm:bean@1.0.15","npm:bonzo@1.4.0","npm:qwery@3.4.2","common/utils/_","common/utils/$"],!1,function(t,e,i){return function(t,e,i,n,o){var s=function(t){var n=i("> *",t).slice(2);e(n).addClass("u-h"),o(".js-blockshare-expand",t).removeClass("u-h")},a=function(){t.on(document.body,"click",".js-blockshare-expand",function(t){var i=e(t.currentTarget),n=i.parent()[0];o("> *",n).removeClass("u-h"),i.addClass("u-h")}),o.forEachElement(".block-share",s)};return{init:a,truncateBlockShareIcons:s}}.call(this,t("npm:bean@1.0.15"),t("npm:bonzo@1.4.0"),t("npm:qwery@3.4.2"),t("common/utils/_"),t("common/utils/$"))})}(),System.register("common/views/content/block-sharing.html!github:systemjs/plugin-text@0.0.2",[],!0,function(require,t,e){var i=System.global,n=i.define;return i.define=void 0,e.exports='<li class="<%=articleType%>-lightbox__item <%=articleType%>-lightbox__item--img js-<%=articleType%>-slide">\n    <div class="<%=articleType%>-lightbox__img-container"><img class="<%=articleType%>-lightbox__img js-<%=articleType%>-lightbox-img"></div>\n    <div class="<%=articleType%>-lightbox__info js-<%=articleType%>-lightbox-info">\n        <div class="<%=articleType%>-lightbox__progress <%=articleType%>-lightbox__progress--info">\n            <span class="<%=articleType%>-lightbox__index"><%=index%></span>\n            <span class="<%=articleType%>-lightbox__progress-separator"></span>\n            <span class="<%=articleType%>-lightbox__count"><%=count%></span>\n            </div>\n        <div class="<%=articleType%>-lightbox__img-caption"><%=caption%></div>\n        <div class="<%=articleType%>-lightbox__img-credit"><%=credit%></div>\n        <div class="block-share block-share--<%=articleType%> hide-on-mobile" data-link-name="block share">\n            <%=shareButtons%>\n        </div>\n        <div class="block-share--<%=articleType%>-mobile" data-open-overlay-on-click="share-modal-<%=index%>" data-link-name="open mobile block share">\n            <button class="block-share__item--mobile button button--small button--tone-media-variant mobile-only">\n                Share\n            </button>\n        </div>\n    </div>\n    <div id="share-modal-<%=index%>" class="overlay share-modal overlay--<%=articleType%> js-share-modal">\n        <div class="share-modal__content" data-link-name="mobile block share">\n            <div class="share-modal__title">Share this post</div>\n            <%=shareButtonsMobile%>\n            <button class="share-modal__close js-overlay-close" data-link-name="close"><i class="i i-close-icon-dark-small"></i><span class="u-h">close</span></button>\n        </div>\n    </div>\n</li>\n',i.define=n,e.exports}),System.register("common/views/content/button.html!github:systemjs/plugin-text@0.0.2",[],!0,function(require,t,e){var i=System.global,n=i.define;return i.define=void 0,e.exports='<div class="gallery-lightbox__btn gallery-lightbox__btn--<%=label%> js-gallery-<%=label%>">\n<button class="gallery-lightbox__btn-body"><i></i><%=label%></button>\n</div>',i.define=n,e.exports}),System.register("common/views/content/endslate.html!github:systemjs/plugin-text@0.0.2",[],!0,function(require,t,e){var i=System.global,n=i.define;return i.define=void 0,e.exports='<li class="gallery-lightbox__item gallery-lightbox__item--endslate js-gallery-slide">\n<div class="gallery-lightbox__endslate js-gallery-endslate fc-container--media"></div>\n</li>',i.define=n,e.exports}),System.register("common/views/content/loader.html!github:systemjs/plugin-text@0.0.2",[],!0,function(require,t,e){var i=System.global,n=i.define;return i.define=void 0,e.exports='<div class="pamplemousse gallery-lightbox__loader js-loader">\n<div class="pamplemousse__pip"><i></i></div>\n<div class="pamplemousse__pip"><i></i></div>\n<div class="pamplemousse__pip"><i></i></div>\n</div>',i.define=n,e.exports}),System.register("common/views/content/share-button.html!github:systemjs/plugin-text@0.0.2",[],!0,function(require,t,e){var i=System.global,n=i.define;return i.define=void 0,e.exports='<a class="rounded-icon block-share__item block-share__item--<%=css%> js-blockshare-link" href="<%=url%>" target="_blank" data-link-name="social <%=css%>">\n    <i class="i"></i>\n    <span class="u-h"><%=text%></span>\n</a>\n',i.define=n,e.exports}),System.register("common/views/content/share-button-mobile.html!github:systemjs/plugin-text@0.0.2",[],!0,function(require,t,e){var i=System.global,n=i.define;return i.define=void 0,e.exports='<a class="share-modal__link" href="<%=url%>" target="_blank" data-link-name="social <%=css%>">\n    <div class="share-modal__item button button--xlarge share-modal__item--<%=css%>">\n        <i class="i"></i>\n        <%=text%>\n    </div>\n</a>',i.define=n,e.exports}),function(){function t(){}t.amd={},System.register("common/modules/gallery/lightbox",["npm:bean@1.0.15","npm:bonzo@1.4.0","npm:qwery@3.4.2","common/utils/_","common/utils/$","common/utils/ajax","common/utils/config","common/utils/detect","common/utils/fsm","common/utils/mediator","common/utils/template","common/utils/url","common/modules/component","common/modules/ui/blockSharing","common/modules/ui/images","common/views/content/block-sharing.html!github:systemjs/plugin-text@0.0.2","common/views/content/button.html!github:systemjs/plugin-text@0.0.2","common/views/content/endslate.html!github:systemjs/plugin-text@0.0.2","common/views/content/loader.html!github:systemjs/plugin-text@0.0.2","common/views/content/share-button.html!github:systemjs/plugin-text@0.0.2","common/views/content/share-button-mobile.html!github:systemjs/plugin-text@0.0.2"],!1,function(t,e,i){return function(t,e,i,n,o,s,a,r,c,l,u,d,h,p,f,m,v,g,y,b,k){function w(){function n(t){var e=v;return u(e,{label:t})}this.showEndslate="mobile"!==r.getBreakpoint()&&"childrens-books-site"!==a.page.section&&"Gallery"===a.page.contentType,this.useSwipe=r.hasTouchScreen(),this.swipeThreshold=.05,this.galleryLightboxHtml='<div class="overlay gallery-lightbox gallery-lightbox--closed gallery-lightbox--hover"><div class="gallery-lightbox__sidebar">'+n("close")+'<div class="gallery-lightbox__progress  gallery-lightbox__progress--sidebar"><span class="gallery-lightbox__index js-gallery-index"></span><span class="gallery-lightbox__progress-separator"></span><span class="gallery-lightbox__count js-gallery-count"></span></div>'+n("next")+n("prev")+n("info-button")+'</div><div class="js-gallery-swipe gallery-lightbox__swipe-container"><ul class="gallery-lightbox__content js-gallery-content"></ul></div></div>',this.lightboxEl=e.create(this.galleryLightboxHtml),this.$lightboxEl=e(this.lightboxEl).prependTo(document.body),this.$indexEl=o(".js-gallery-index",this.lightboxEl),this.$countEl=o(".js-gallery-count",this.lightboxEl),this.$contentEl=o(".js-gallery-content",this.lightboxEl),this.nextBtn=i(".js-gallery-next",this.lightboxEl)[0],this.prevBtn=i(".js-gallery-prev",this.lightboxEl)[0],this.closeBtn=i(".js-gallery-close",this.lightboxEl)[0],this.infoBtn=i(".js-gallery-info-button",this.lightboxEl)[0],this.$swipeContainer=o(".js-gallery-swipe"),t.on(this.nextBtn,"click",this.trigger.bind(this,"next")),t.on(this.prevBtn,"click",this.trigger.bind(this,"prev")),t.on(this.closeBtn,"click",this.close.bind(this)),t.on(this.infoBtn,"click",this.trigger.bind(this,"toggle-info")),this.handleKeyEvents=this.handleKeyEvents.bind(this),this.resize=this.trigger.bind(this,"resize"),this.toggleInfo=function(t){var i=e(t.target).hasClass("js-gallery-lightbox-info")||o.ancestor(t.target,"js-gallery-lightbox-info");i||this.trigger("toggle-info")}.bind(this),r.hasTouchScreen()&&this.disableHover(),t.on(window,"popstate",function(t){t.state||this.trigger("close")}.bind(this)),this.fsm=new c({initial:"closed",onChangeState:function(t,e){this.$lightboxEl.removeClass("gallery-lightbox--"+t).addClass("gallery-lightbox--"+e)},context:this,states:this.states})}function j(){if("lightboxImages"in a.page&&a.page.lightboxImages.images.length>0){var i,n,o,s,r=window.location.hash,c=a.page.lightboxImages;t.on(document.body,"click",".js-gallerythumbs",function(t){t.preventDefault();var n=e(t.currentTarget),o=n.attr("href")||n.attr("data-gallery-url"),s=o.split("#img-"),a=parseInt(s[1],10),r=isNaN(a)?1:a;i=i||new w,i.loadGalleryfromJson(c,r)}),i=i||new w,n="/"+a.page.pageId,o=/\?index=(\d+)/.exec(document.location.href),o?(d.pushUrl(null,document.title,n,!0),i.loadGalleryfromJson(c,parseInt(o[1],10))):(s=/^#(?:img-)?(\d+)$/.exec(r),s&&i.loadGalleryfromJson(c,parseInt(s[1],10)))}}return w.prototype.generateImgHTML=function(t,e){var i=a.page.shortUrl,o=0===t.src.indexOf("//")?"http:":"",s=[{text:"Facebook",css:"facebook",url:"https://www.facebook.com/sharer/sharer.php?u="+encodeURIComponent(i+"/sfb#img-"+e)},{text:"Twitter",css:"twitter",url:"https://twitter.com/intent/tweet?text="+encodeURIComponent(a.page.webTitle)+"&url="+encodeURIComponent(i+"/stw#img-"+e)},{text:"Pinterest",css:"pinterest",url:encodeURI("http://www.pinterest.com/pin/create/button/?description="+a.page.webTitle+"&url="+i+"&media="+o+t.src)}];return u(m.replace(/^\s+|\s+$/gm,""),{articleType:"gallery",count:this.images.length,index:e,caption:t.caption,credit:t.displayCredit?t.credit:"",blockShortUrl:i,shareButtons:n.map(s,u.bind(null,b)).join(""),shareButtonsMobile:n.map(s,u.bind(null,k)).join("")})},w.prototype.initSwipe=function(){var e,i,o,s,a=20;t.on(this.$swipeContainer[0],"touchstart",function(t){e=this.swipeContainerWidth*this.swipeThreshold,i=t.touches[0].pageX,o=0}.bind(this)),s=function(t){t.preventDefault(),t.touches.length>1||t.scale&&1!==t.scale||(o=t.touches[0].pageX-i,this.translateContent(this.index,o,a))}.bind(this),t.on(this.$swipeContainer[0],"touchmove",n.throttle(s,a,{trailing:!1})),t.on(this.$swipeContainer[0],"touchend",function(){var t;t=Math.abs(o)>e?o>e?1:-1:0,o=0,1===t?this.index>1?this.trigger("prev"):this.trigger("reload"):-1===t&&this.index<this.$slides.length?this.trigger("next"):this.trigger("reload")}.bind(this))},w.prototype.disableHover=function(){this.$lightboxEl.removeClass("gallery-lightbox--hover")},w.prototype.trigger=function(t,e){this.fsm.trigger(t,e)},w.prototype.loadGalleryfromJson=function(t,e){this.index=e,this.galleryJson&&t.id===this.galleryJson.id?this.trigger("open"):this.trigger("loadJson",t)},w.prototype.loadSurroundingImages=function(i,s){var a,r,c;n([-1,0,1]).map(function(t){return i+t===0?s-1:(i-1+t)%s}).each(function(i){a=this.images[i],r=e(this.$images[i]),r.attr("src")||(c=r.parent().append(e.create(y)),r.attr("src",a.src),r.attr("srcset",a.srcsets),r.attr("sizes",a.sizes),t.one(r[0],"load",function(){o(".js-loader").remove()}))}.bind(this))},w.prototype.translateContent=function(t,e,i){var n=-1*(t-1)*this.swipeContainerWidth,o=this.$contentEl[0];o.style.webkitTransitionDuration=i+"ms",o.style.mozTransitionDuration=i+"ms",o.style.msTransitionDuration=i+"ms",o.style.transitionDuration=i+"ms",o.style.webkitTransform="translate("+(n+e)+"px,0)translateZ(0)",o.style.mozTransform="translate("+(n+e)+"px,0)",o.style.msTransform="translate("+(n+e)+"px,0)",o.style.transform="translate("+(n+e)+"px,0)translateZ(0)"},w.prototype.states={closed:{enter:function(){this.hide()},leave:function(){this.show(),d.pushUrl({},document.title,"/"+this.galleryJson.id)},events:{open:function(){this.swipe&&this.swipe.slide(this.index,0),this.state="image"},loadJson:function(t){this.galleryJson=t,this.images=t.images,this.$countEl.text(this.images.length);var i=n(this.images).map(function(t,e){return this.generateImgHTML(t,e+1)}.bind(this)).join("");this.$contentEl.html(i),this.$images=o(".js-gallery-lightbox-img",this.$contentEl[0]),this.showEndslate&&this.loadEndslate(),this.$slides=o(".js-gallery-slide",this.$contentEl[0]),this.useSwipe&&this.initSwipe(),this.galleryJson.images.length<2&&(e([this.nextBtn,this.prevBtn]).hide(),o(".gallery-lightbox__progress",this.lightboxEl).hide()),this.state="image"}}},image:{enter:function(){this.swipeContainerWidth=this.$swipeContainer.dim().width,this.loadSurroundingImages(this.index,this.images.length),this.translateContent(this.index,0,this.useSwipe&&r.isBreakpoint({max:"tablet"})?100:0),d.pushUrl({},document.title,"/"+this.galleryJson.id+"#img-"+this.index,!0),t.on(this.$swipeContainer[0],"click",".js-gallery-content",this.toggleInfo),l.on("window:resize",this.resize),this.$indexEl.text(this.index),f.upgradePictures()},leave:function(){t.off(this.$swipeContainer[0],"click",this.toggleInfo),l.off("window:resize",this.resize)},events:{next:function(t){this.trackInteraction(t+":next"),this.pulseButton(this.nextBtn),this.index===this.images.length?this.showEndslate?this.state="endslate":(this.index=1,this.reloadState=!0):(this.index+=1,this.reloadState=!0)},prev:function(t){this.trackInteraction(t+":previous"),this.pulseButton(this.prevBtn),1===this.index?this.showEndslate?this.state="endslate":(this.index=this.images.length,this.reloadState=!0):(this.index-=1,this.reloadState=!0)},reload:function(){this.reloadState=!0},"toggle-info":function(){this.pulseButton(this.infoBtn),this.$lightboxEl.toggleClass("gallery-lightbox--show-info")},"hide-info":function(){this.pulseButton(this.infoBtn),this.$lightboxEl.removeClass("gallery-lightbox--show-info")},"show-info":function(){this.pulseButton(this.infoBtn),this.$lightboxEl.addClass("gallery-lightbox--show-info")},resize:function(){this.swipeContainerWidth=this.$swipeContainer.dim().width,this.loadSurroundingImages(this.index,this.images.length),this.translateContent(this.index,0,0)},close:function(){this.state="closed"}}},endslate:{enter:function(){this.translateContent(this.$slides.length,0,0),this.index=this.images.length+1,l.on("window:resize",this.resize)},leave:function(){l.off("window:resize",this.resize)},events:{next:function(t){this.trackInteraction(t+":next"),this.pulseButton(this.nextBtn),this.index=1,this.state="image"},prev:function(t){this.trackInteraction(t+":previous"),this.pulseButton(this.prevBtn),this.index=this.images.length,this.state="image"},reload:function(){this.reloadState=!0},resize:function(){this.swipeContainerWidth=this.$swipeContainer.dim().width,this.translateContent(this.$slides.length,0,0)},close:function(){this.state="closed"}}}},w.prototype.show=function(){var i=e(document.body);this.bodyScrollPosition=i.scrollTop(),i.addClass("has-overlay"),this.$lightboxEl.addClass("gallery-lightbox--open"),t.off(document.body,"keydown",this.handleKeyEvents),t.on(document.body,"keydown",this.handleKeyEvents)},w.prototype.close=function(){d.hasHistorySupport?d.back():this.trigger("close"),this.trigger("close")},w.prototype.hide=function(){var i=e(document.body);i.removeClass("has-overlay"),t.off(document.body,"keydown",this.handleKeyEvents),window.setTimeout(function(){this.bodyScrollPosition&&i.scrollTop(this.bodyScrollPosition),this.$lightboxEl.removeClass("gallery-lightbox--open"),f.upgradePictures(),l.emit("ui:images:vh")}.bind(this),1)},w.prototype.pulseButton=function(t){var i=e(t);i.addClass("gallery-lightbox__button-pulse"),window.setTimeout(function(){i.removeClass("gallery-lightbox__button-pulse")},75)},w.prototype.handleKeyEvents=function(t){37===t.keyCode?this.trigger("prev"):39===t.keyCode?this.trigger("next"):38===t.keyCode?this.trigger("show-info"):40===t.keyCode?this.trigger("hide-info"):27===t.keyCode?this.close():73===t.keyCode&&this.trigger("toggle-info")},w.prototype.endslate=new h,w.prototype.loadEndslate=function(){this.endslate.rendered||(this.endslateEl=e.create(g),this.$contentEl.append(this.endslateEl),this.endslate.componentClass="gallery-lightbox__endslate",this.endslate.endpoint="/gallery/most-viewed.json",this.endslate.ready=function(){l.emit("page:new-content")},this.endslate.prerender=function(){e(this.elem).addClass(this.componentClass)},this.endslate.fetch(i(".js-gallery-endslate",this.endslateEl),"html"))},w.prototype.trackInteraction=function(t){l.emit("module:clickstream:interaction",t)},{init:j,GalleryLightbox:w}}.call(this,t("npm:bean@1.0.15"),t("npm:bonzo@1.4.0"),t("npm:qwery@3.4.2"),t("common/utils/_"),t("common/utils/$"),t("common/utils/ajax"),t("common/utils/config"),t("common/utils/detect"),t("common/utils/fsm"),t("common/utils/mediator"),t("common/utils/template"),t("common/utils/url"),t("common/modules/component"),t("common/modules/ui/blockSharing"),t("common/modules/ui/images"),t("common/views/content/block-sharing.html!github:systemjs/plugin-text@0.0.2"),t("common/views/content/button.html!github:systemjs/plugin-text@0.0.2"),t("common/views/content/endslate.html!github:systemjs/plugin-text@0.0.2"),t("common/views/content/loader.html!github:systemjs/plugin-text@0.0.2"),t("common/views/content/share-button.html!github:systemjs/plugin-text@0.0.2"),t("common/views/content/share-button-mobile.html!github:systemjs/plugin-text@0.0.2"))})}(),function(){function t(){}t.amd={},System.register("bootstraps/image-content",["common/modules/gallery/lightbox"],!1,function(t,e,i){return function(t){var e=function(){t.init()};return{init:e}}.call(this,t("common/modules/gallery/lightbox"))})}();